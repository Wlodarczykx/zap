var snake=function(){var e,t=!1,i=17,o="",n=40,d=640,r=480,a=["left","right","up","down"],s={x:n,y:n,size:3,direction:"right",body:[]},y=null,l={state:"play",lethaledges:!0,score:0},c={cycle:[],started:[],stopped:[],gameover:[]},h=0;return notify=function(e,t){if(void 0!==c[e])for(var i=0;i<c[e].length;i++)c[e][i](t)},gameover=function(e){l.state="gameover",stop(),notify("gameover",{reason:e})},moveHead=function(){switch(s.direction){case"left":s.x-=n;break;case"right":s.x+=n;break;case"up":s.y-=n;break;case"down":s.y+=n}for(var e in d<s.x+n&&(s.x=600,l.lethaledges&&gameover("hitedge")),0>s.x&&(s.x=0,l.lethaledges&&gameover("hitedge")),r<s.y+n&&(s.y=440,l.lethaledges&&gameover("hitedge")),0>s.y&&(s.y=0,l.lethaledges&&gameover("hitedge")),s.body)s.x===s.body[e].x&&s.y===s.body[e].y&&gameover("hitself");null!==y&&s.x===y.x&&s.y===y.y&&(y=null,s.size++,l.score+=10)},moveBody=function(){void 0!==e?e.x===s.x&&e.y===s.y||(s.body.length+1===s.size&&s.body.shift(),s.body.length+1<s.size&&("right"===s.direction&&e.x===s.x-n&&addBody(e),"left"===s.direction&&e.x===s.x+n&&addBody(e),"up"===s.direction&&e.y===s.y+n&&addBody(e),"down"===s.direction&&e.y===s.y-n&&addBody(e),e={x:s.x,y:s.y})):e={x:s.x,y:s.y}},moveSnake=function(){moveHead(),moveBody()},addBody=function(e){s.body.push({x:e.x,y:e.y})},spawnApple=function(){if(null===y){var e=320;middleheight=240,quadrant=null,quadrants=[[0,0,e,middleheight],[e,0,600,middleheight],[0,middleheight,e,440],[e,middleheight,600,440]],0<=s.x&&s.x<e&&(0<=s.y&&s.y<middleheight?quadrants.splice(0,1):quadrants.splice(2,1)),e<=s.x&&(0<=s.y&&s.y<middleheight?quadrants.splice(1,1):quadrants.splice(3,1)),quadrant=quadrants[Math.floor(3*Math.random())],y={x:quadrant[0]+n*Math.floor(Math.floor(Math.random()*e)/n),y:quadrant[1]+n*Math.floor(Math.floor(Math.random()*middleheight)/n),color:["#9400D3","#4B0082","#0000FF","#FFFF00","#FF7000","#FF0000"][h%6]},isHitSnake(y)&&(0<s.body.length?(y.x=s.body[0].x,y.y=s.body[0].y):(y.x=s.x,y.y=s.y))}},isHitPosition=function(e,t){return e.x===t.x&&e.y===t.y},isHitSnake=function(e){var t=!1;if(isHitPosition(y,s))t=!0;else for(var i in s.body)isHitPosition(y,s.body[i])&&(t=!0);return t},dothing=function(){h++,"play"===l.state&&h%5==0&&(moveSnake(),spawnApple()),notify("cycle",{count:h,snake:s,apple:y,game:l})},init=function(){start()},start=function(){t||(t=!0,o=setInterval(dothing,i),notify("started"))},stop=function(){t&&(t=!1,clearInterval(o),notify("stopped"))},toggle=function(){t?stop():start()},reconfigure=function(e){var t;stop(),i=parseInt(e.interval||i),t=parseInt(e.size||s.size),s.size=t,0<s.body.length-(t-1)&&s.body.splice(0,s.body.length-(t-1)),start()},isHit180=function(e,t){if(0!==s.body.length)return s.body[s.body.length-1].x===e&&s.body[s.body.length-1].y===t},isDirectionBlocked=function(e){var t=!1;return"left"===e&&isHit180(s.x-n,s.y)&&(t=!0),"right"===e&&isHit180(s.x+n,s.y)&&(t=!0),"up"===e&&isHit180(s.x,s.y-n)&&(t=!0),"down"===e&&isHit180(s.x,s.y+n)&&(t=!0),("left"===s.direction&&"down"===e||"right"===s.direction&&"down"===e)&&r<s.y+n&&(t=!0),("left"===s.direction&&"up"===e||"right"===s.direction&&"up"===e)&&0>s.y-n&&(t=!0),("up"===s.direction&&"left"===e||"down"===s.direction&&"left"===e)&&0>s.x-n&&(t=!0),("up"===s.direction&&"right"===e||"down"===s.direction&&"right"===e)&&d<s.x+n&&(t=!0),t},setSnakeDirection=function(e){t&&-1!==a.indexOf(e)&&(isDirectionBlocked(e)||(s.direction=e))},reset=function(){l.state="play",l.score=0,s.size=3,s.body=[],s.x=n,s.y=n,s.direction="right",y=null,start()},{toggle:toggle,init:init,hook:function(e,t){void 0!==c[e]&&c[e].push(t)},unhook:function(e,t){if(void 0!==c[e])for(var i=0;i<c[e].length;i++)c[e][i]===t&&c[e].splice(i)},reconfigure:reconfigure,setSnakeDirection:setSnakeDirection,reset:reset}}();